<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkyWallet – Mine App</title>
<style>
body {
  font-family: Arial;
  background:#0f0f0f;
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}
.card {
  background:#1a1a1a;
  padding:20px;
  border-radius:8px;
  width:340px;
  text-align:center;
  box-shadow:0 0 10px rgba(0,0,0,0.6);
}
input, button {
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:4px;
  border:none;
}
button {
  background:#00ff99;
  color:#000;
  font-weight:bold;
  cursor:pointer;
}
button:hover { background:#00cc7a; }
.divider { margin:15px 0; height:1px; background:#333; }
.status { margin-top:10px; font-size:14px; }
</style>
</head>
<body>
<div class="card">
  <h1>⛏️ Mine SKD</h1>
  <p class="balance">Balance: 0 SKD</p>

  <div class="divider"></div>

  <h2>Convert</h2>
  <input class="amount" placeholder="SKD amount">
  <button onclick="convert('NGN')">SKD → ₦</button>
  <button onclick="convert('USD')">SKD → $</button>

  <div class="divider"></div>

  <h2>SkyWallet</h2>
  <p class="walletNGN">₦ Wallet: 0</p>
  <p class="walletUSD">$ Wallet: 0</p>
  <p class="locked">Locked: 0</p>

  <div class="divider"></div>

  <h2>Withdraw</h2>
  <input class="withdrawAmt" placeholder="₦ amount">
  <input class="bank" placeholder="Bank / Moniepoint">
  <button onclick="withdraw()">Withdraw</button>

  <div class="status"></div>
</div>

<script>
const balance = document.querySelector(".balance");
const walletNGN = document.querySelector(".walletNGN");
const walletUSD = document.querySelector(".walletUSD");
const locked = document.querySelector(".locked");
const status = document.querySelector(".status");

async function loadWallet() {
  try {
    const r = await fetch("/wallet");
    const w = await r.json();
    balance.innerText = `Balance: ${w.balance} SKD`;
    walletNGN.innerText = `₦ Wallet: ${w.wallet.ngn.toLocaleString()}`;
    walletUSD.innerText = `$ Wallet: ${w.wallet.usd.toLocaleString()}`;
    locked.innerText = `Locked: ${w.locked.toLocaleString()}`;
  } catch {
    status.textContent = "❌ Failed to load wallet";
  }
}

async function convert(currency) {
  const skd = Number(document.querySelector(".amount").value);
  if (!skd) return status.textContent = "❌ Enter SKD amount";
  try {
    await fetch("/convert", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({ amount: skd, currency })
    });
    status.textContent = "✅ Converted successfully";
    loadWallet();
  } catch {
    status.textContent = "❌ Conversion failed";
  }
}

async function withdraw() {
  const amountNGN = Number(document.querySelector(".withdrawAmt").value);
  const bank = document.querySelector(".bank").value;
  if (!amountNGN || !bank) return status.textContent = "❌ Fill all withdrawal fields";
  try {
    const r = await fetch("/withdraw", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({ amountNGN, bank })
    });
    const d = await r.json();
    status.textContent = d.message || d.error;
    loadWallet();
  } catch {
    status.textContent = "❌ Withdrawal failed";
  }
}

setInterval(async () => {
  await fetch("/mine", { method:"POST" });
  loadWallet();
}, 1000);

loadWallet();
</script>
</body>
    </html>
